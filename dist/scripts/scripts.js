"use strict";var walternateApp=angular.module("walternateApp",["ngResource"]).config(["$routeProvider",function(e){e.when("/Relations/:movieId",{templateUrl:"views/relations.html",controller:"RelationsController"}).when("/Relations/:movieId/graph",{templateUrl:"views/graph.html",controller:"GraphController"}).otherwise({redirectTo:"/"})}]).run(["localNavigationStorage",function(e){e.init()}]);walternateApp.controller("SearchController",["$scope","$resource",function(e,o){e.configuration=o("/api/configuration",{format:"json"}).get(),e.moviedb=o("/api/searchMovie/:title",{title:"@title",format:"json"}),e.search=function(o){e.movies=e.moviedb.get({title:o})},e.clear=function(){e.movies={}}}]),walternateApp.controller("RelationsController",["$scope","$resource","$routeParams","localNavigationStorage",function(e,o,t,a){e.configuration=o("/api/configuration",{format:"json"}).get(),e.graphdb=o("/query/:id",{id:"@id",format:"json"}),e.relations=e.graphdb.query({id:t.movieId}),a.add(t.movieId)}]),walternateApp.controller("GraphController",["$scope","$resource","$routeParams",function(e,o,t){e.configuration=o("/api/configuration",{format:"json"}).get();var a=o("/query/:id",{id:"@id",format:"json"}),i=a.query({id:t.movieId},function(){var e=document.getElementById("sig"),o=sigma.init(e).drawingProperties({defaultLabelColor:"#fff",defaultLabelSize:14,defaultLabelBGColor:"#fff",defaultLabelHoverColor:"#000",labelThreshold:1,defaultEdgeType:"curve"}).graphProperties({minNodeSize:.5,maxNodeSize:5,minEdgeSize:1,maxEdgeSize:1});o.addNode(t.movieId,{label:t.movieId,color:"#00ff00",x:1});for(var a in i){var r=i[a],n=2*Math.random()*Math.PI;try{o.addNode(r.person.name,{label:r.person.name,color:"#ff0000",x:20*Math.cos(n),y:20*Math.sin(n)})}catch(l){}try{o.addNode(r.movie.title,{label:r.movie.title,color:"#00ff00",x:30*Math.cos(n),y:30*Math.sin(n)})}catch(l){}try{o.addEdge(t.movieId+"_"+r.person.name,t.movieId,r.person.name)}catch(l){}o.addEdge(r.person.name+"_"+r.movie.title,r.person.name,r.movie.title)}o.bind("overnodes",function(e){var t=e.content,a={};o.iterEdges(function(e){(t.indexOf(e.source)>=0||t.indexOf(e.target)>=0)&&(a[e.source]=1,a[e.target]=1)}).iterNodes(function(e){e.hidden=a[e.id]?0:1}).draw(2,2,2)}).bind("outnodes",function(){o.iterEdges(function(e){e.hidden=0}).iterNodes(function(e){e.hidden=0}).draw(2,2,2)}),o.draw()})}]),walternateApp.controller("LocalNavigationController",["$scope","$rootScope","$resource","localNavigationStorage",function(e,o,t,a){e.configuration=t("/api/configuration",{format:"json"}).get(),o.$watch("localNavigation",function(o){e.history=o}),e.clearNavigation=function(){a.clear()}}]),walternateApp.factory("localNavigationStorage",["$rootScope","$resource",function(e,o){var t="walternate-history",a=o("/api/movieInfo/:id",{id:"@id",format:"json"}),i=function(){e.localNavigation=r()},r=function(){return JSON.parse(localStorage.getItem(t)||"[]")};return{init:i,get:r,add:function(o){a.get({id:o},function(o){var a=r();(_.isEmpty(a)||o.id!=a[0].id)&&a.unshift(o),localStorage.setItem(t,JSON.stringify(a)),e.localNavigation=r()})},clear:function(){localStorage.removeItem(t),e.localNavigation=[]}}}]);